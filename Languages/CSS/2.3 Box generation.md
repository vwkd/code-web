# Box generation

[TOC]



## Introduction

- for each element one or more boxes (*) are created in box tree
- box tree hierarchy stays the same as document tree hierarchy ❗
- one box is the principal box, additional helper boxes may be created, usually only one additional ???
- boxes can be nested or at same depth ??? usually only nested with outer being the principal box???
- principal box contains boxes of descendant elements
- anonymous boxes that don't belong to any element may be created
- (*) zero boxes may be created, see `display: none` or `display: contents`

### Principal box

- main box of element
- contains generated content of element
- contains boxes of descendant elements
- is applied style of element, see Helper box for exceptions


(((Certain properties can force a principal box to establish a new (independent) formatting context, e.g. making a box out-of-flow, or Turning a block (???) into a scroll container )))

### Helper box

- additional box of element
- placed with respect to the principal box

(such as list-item elements, which generate an additional marker box, or table elements, which generate a principal table wrapper box and an additional table grid box)

- generated for some display types of the element
e.g. `display: list-item` generates an additional marker box within principal box, `display: table` generates an additional table grid box within the principal table wrapper box
- inherits style from principal box through box tree
- some non-inherited properties are applied to helper box instead of principal box, e.g. border properties applied to `display: table` element are applied to its helper table grid box instead of its principal table wrapper box

### Anonymous box

- box that is not associated with an element
- fixes up box tree when a particular nested structure is required that is not provided by the boxes generated from the element tree, e.g. a table cell box generates an anonymous table row box around itself if its parent box is not a table row box
- inherits style from box tree parentage, since has no associated element



## Display type

- specifies type(s) of box(es) generated for element
- beware: user agent style sheet may set any value, overrides initial value ❗️
(((more values not covered here)))

### Box generation specific

- `display: none`: no boxes are generated for element and descendant
- as if element hadn't been in the document tree
- beware: only affects box tree but not document tree, i.e. selectors, property inheritance, event handling, etc. are not affected ❗️
- `display: contents`: no boxes are generated for element, but are generated for descendant elements
- as if element had been replaced in the document tree by its descendants
- beware: `::before` and `::after` pseudo-elements are treated like descendant elements, `::before` is first child, `::after` is last child
- beware: only affects box tree but not document tree, i.e. selectors, property inheritance, event handling, etc. are not affected ❗️

### Layout specific

- `display: <display-outside> || <display-inside>`
- can be in any order, if only one is specified the others default depends on specified value ???
- initial value is `inline`, i.e. `inline flow`
- beware: layout-specific display type only affects visual layout, doesn't change semantics of element ❗️

#### Outer display type (ODT)

role of box in parent FC
only used for Flow Layout at the moment

- role of principal box in flow layout, see Flow Layout
- `block`: block-level, default for inner display types except `ruby`
- `inline`: inline-level, default for inner display type `ruby`

#### Inner display type (IDT)

type of FC the box establishes for children

- type of boxes generated
- type of formatting context established by boxes
- `flow` is default for any outer display type

| IDT | PB | PB FC | HB | HB FC | notes |
| - | - | - | - | - | - |
| `flow` | inline box | continues same inline FC | - | - | if ODT not `block` and parent formatting context block / inline |
| `flow` | block container box | ?? | - | - | otherwise |
| `flow-root` | block container box | new block FC | - | - | - |
| `table` | table wrapper box | new block FC | table grid box | new table FC | - |
| `flex` | flex container box | new flex FC | - | - | - |
| `grid` | grid container box | new grid FC | - | - | - |
| `ruby` | ruby container box | new ruby FC | - | - | if ODT `inline` |
| `ruby` | wrapper box | new inline FC | ruby container box | new ruby FC | otherwise |

#### Shorthands

- specifies both inner and outer display type

| shorthand | longhand | generated box |
| - | - | - |
| `block` | `block flow` | block box |
| `flow-root` | `block flow-root` | block box that establishes a new block formatting context |
| `inline` | `inline flow` | inline box |
| `inline-block` | `inline flow-root` | inline-level block container |
| `flex` | `block flex` | block-level flex container |
| `inline-flex` | `inline flex` | inline-level flex container |
| `grid` | `block grid` | block-level grid container |
| `inline-grid` | `inline grid` | inline-level grid container |

(((
blockification: set outer display type of box to block
inlinification: set outer display type of box to inline

If a `block flow` box is inlinified, its inner display type is set to `flow-root` so that it remains a block container.

If an `inline flow` box is inlinified, it recursively inlinifies all of its in-flow children, so that no block-level descendants break up the inline formatting context in which it participates.
)))


## Resources

- [W3C - CSS Display Module Level 3](https://www.w3.org/TR/css-display-3/)