# Box generation

[TOC]



## Introduction

defines when a box is generated

controled with the `display` property

## 

- for each element zero or more boxes are created
zero
- for each element a principal box is created
controled with `display: none`
i.e. not each element has one box

- some elements generate additional helper boxes, e.g. `<li>` elements generate an additional marker box, `table` elements generate an additional table grid box besides their principal table wrapper box
controled with `display: list-item`, ... ?

- box(es) take style from generating element
UNLESS OTHERWISE SPECIFIED
e.g. the `border` properties applied to a table element are applied to its table grid box, not to its principal table wrapper box

boxes generated by an element are descendants of the principal box of any ancestor elements

- anonymous box: box not associated with an element, fix up when principal boxes don't provide nested structure
e.g. a table cell box generates an anonymous table row box around itself if its parent box is not a table row box
i.e. not each box belongs to one element
anonymous boxes inherit style from box tree parentage, since have no associated element with a CSS property

a box can "break" into fragments, e.g. end of line, end of page on print, etc.
<!-- ToDo: see css-break-4 -->


## Terminology

principal box: box of element, contains its descendant boxes and generated content, and is also the box involved in any positioning scheme
to distinguish from helper boxes and anonymous boxes

containing block: rectangle that forms the basis of sizing and positioning for the boxes associated with it, often derived from dimensions of a box
Each box is given a position with respect to its containing block, but it is not confined by this containing block; it can overflow.
usually a box establishes the containing block for descendant boxes, BUT NOT NECESSARILY???
e.g. inline box’s containing block is the content box of its closest block container ancestor
absolutely positioned boxes containing block is the padding edges of its closest positioned ancestor

initial containing block: containing block of the root element

formatting context: layout environment, environment with a specific layout of boxes, can co-exist and be part of each other
established by a box, dictates how its descendant boxes are laid out

A box either establishes a new formatting context (independent, Unless otherwise specified) or continues the formatting context of its containing block. The type of formatting context established by the box is determined by its inner display type.

independent formatting context: formatting context not affected by and not affecting the the formatting context outside, except through the sizing of the box itself, e.g. margins do not collapse across formatting context boundaries (((except exclusions can are able to affect content across independent formatting context boundaries)))
Certain properties can force a box to establish an independent formatting context, e.g. making a box out-of-flow, or Turning a block (???) into a scroll container

out-of-flow box: box laid out differently from parent formatting context, extracted from its expected position and interaction with surrounding content, laid out using a different paradigm outside the normal flow of content in its parent formatting context, e.g. box is floated or absolutely positioned.
in-flow box: box that is not out-of-flow, i.e. laid out using parent formatting context
normal flow: ??? expected layout in formatting context ??? MAYBE DELETE


## Display types

- defines how an element generates boxes
- controled with `display`

`none`:  element and contents omitted from box tree, as if element hadn't been in the element tree
`contents`: element replaced by contents in box tree, as if element had been replaced in the element tree by its contents

- outer display type: role of principal box in flow layout
block: block-level, default if only inner display type is used (FOR MOST INNER DISPLAY TYPES)
inline: inline-level
- inner display type: type of formatting context the principal box establishes for its descendants
flow: flow layout, default if only inner display type is used (FOR MOST OUTER DISPLAY TYPES), see Flow Layout
If its outer display type is `inline` and it is participating in a block or inline formatting context, then it generates an inline box.
Otherwise it generates a block container box.
Depending on the value of other properties (such as position, float, or overflow) and whether it is itself participating in a block or inline formatting context, it either establishes a new block formatting context for its contents or integrates its contents into its parent formatting context. A block container that establishes a new block formatting context is considered to have a used inner display type of flow-root.
flow-root:
The element generates a block container box, and lays out its contents using flow layout. It always establishes a new block formatting context for its contents.
flex: The element generates a principal flex container box and establishes a flex formatting context.
grid: The element generates a principal grid container box, and establishes a grid formatting context.


Some display values have additional side-effects, e.g. `list-item` generates an additional `::marker` pseudo-element, or `none` causes the element’s entire subtree to be left out of the box tree



beware: changing display type doesn't change semantics of element, only affects visual layout

initial value is `inline`, i.e. `inline flow`
beware: often changed by user agent style sheet !!!!!

shorthands specify both inner and outer display type in one
values of `display`

| shorthand | longhand | generated box |
| - | - | - |
| `block` | `block flow` | block box |
| `flow-root` | `block flow-root` | block box that establishes a new block formatting context |
| `inline` | `inline flow` | inline box |
| `inline-block` | `inline flow-root` | inline-level block container |
| `flex` | `block flex` | block-level flex container |
| `inline-flex` | `inline flex` | inline-level flex container |
| `grid` | `block grid` | block-level grid container |
| `inline-grid` | `inline grid` | inline-level grid container |


more values not covered here

(((
blockification: set outer display type of box to block
inlinification: set outer display type of box to inline

If a `block flow` box is inlinified, its inner display type is set to `flow-root` so that it remains a block container.
If an `inline flow` box is inlinified, it recursively inlinifies all of its in-flow children, so that no block-level descendants break up the inline formatting context in which it participates.
)))