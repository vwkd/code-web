# Layout

[TOC]


<!-- ToDo: Finish -->


## Box model

each element in the document tree generates zero or more boxes according to the box model

Layout is determined by
  box dimensions and type.
  positioning scheme (normal flow, float, and absolute positioning).
  relationships between elements in the document tree.
  external information (e.g., viewport size, intrinsic dimensions of images, etc.).

#### Viewport

window or other viewing area on the screen through which users consult a document
document's layout may changer when viewport is resized
if viewport is smaller than rendered document, user agent offers scrolling mechanism

#### Containing block

- box respective to which position and size of a descendant box is calculated
- beware: descendant box is positioned with respect to its containing block, but it is not confined by this containing block, it may overflow ❗️
- usually the parent, e.g. ul of li, but not necessarily ????????

#### `display` property

- specifies a box's type
- may generate "principal box", respective to which descendant boxes are positioned
- may generate more boxes for descendant elements, e.g. `list-item`

element becomes block-level: 'block', 'list-item', and 'table'
element becomes block container: 'block', 'list-item', and 'table'

element becomes inline-level: 'inline', 'inline-table', and 'inline-block'
'inline' generates an inline box

#### Box type

Block-level element: element that is formatted visually as block
generates a block-level principal box
Block-level box: box that participate in a block formatting context
block container box: box that either contains only block-level boxes or establishes an inline formatting context and thus contains only inline-level boxes, "block container elements"
block box: box that is both block-level and a block container
beware: not all block container boxes are block-level boxes, e.g. inline blocks and table cells

Inline-level element: element that do not form new blocks of content, content is distributed in lines, e.g., emphasized pieces of text within a paragraph, inline images, etc.
generates inline-level boxes
inline-level box: box that participates in an inline formatting context
inline box: box that is both inline-level and whose contents participate in its containing inline formatting context
beware: not all inline-level boxes are inline boxes, e.g. replaced inline-level elements, inline-block elements, and inline-table elements

#### Anonymous boxes

...
if a block container box has a block-level box inside it, then we force it to have only block-level boxes inside it

#### Positioning schemes

boxes may be laid out according to three positioning schemes:

- Normal flow: includes block formatting of block-level boxes, inline formatting of inline-level boxes, and relative positioning of block-level and inline-level boxes, standard ?!
- float model: a box is first laid out according to the normal flow, then taken out of the flow and shifted to the left or right as far as possible. Content may flow along the side of a float.
- Absolute positioning model: a box is removed from the normal flow entirely (it has no impact on later siblings) and assigned a position with respect to a containing block.

An element is called out of flow if it is floated, absolutely positioned, or is the root element.
An element is called in-flow if it is not out-of-flow.
The flow of an element A is the set consisting of A and all in-flow elements whose nearest out-of-flow ancestor is A.


#### Block formatting context

- boxes are laid out one after the other, vertically, beginning at the top of a containing block.
each box's left outer edge touches the left edge of the containing block (for right-to-left formatting, right edges touch)
(his is true even in the presence of floats (although a box's line boxes may shrink due to the floats), unless the box establishes a new block formatting context (in which case the box itself may become narrower due to the floats).)

The vertical distance between two sibling boxes is determined by the 'margin' properties.
Vertical margins between adjacent block-level boxes in a block formatting context collapse.

boxes that establish new block formatting contexts for their contents:
  - Floats
  - absolutely positioned elements
  - block containers (such as inline-blocks, table-cells, and table-captions) that are not block boxes
  - block boxes with 'overflow' other than 'visible' (except when that value has been propagated to the viewport)

#### Inline formatting contexts

boxes are laid out horizontally, one after the other, beginning at the top of a containing block
The boxes may be aligned vertically in different ways: their bottoms or tops may be aligned, or the baselines of text within them may be aligned.
line box: rectangular area that contains the boxes that form a line
always tall enough for all of the boxes it contains, might be taller than the tallest box due to alignment
When several inline-level boxes cannot fit horizontally within a single line box, they are distributed among two or more vertically-stacked line boxes. Thus, a paragraph is a vertical stack of line boxes. Line boxes are stacked with no vertical separation (except as specified elsewhere) and they never overlap.
When an inline box exceeds the width of a line box, it is split into several boxes and these boxes are distributed across several line boxes. If an inline box cannot be split then the inline box overflows the line box. When an inline box is split, margins, borders, and padding have no visual effect where the split occurs. Inline boxes may also be split into several boxes within the same line box due to bidirectional text processing.
Line boxes are created as needed to hold inline-level content within an inline formatting context.


When the height of a box is less than the height of the line box containing it, the vertical alignment of the box within the line box is determined by the 'vertical-align' property.
When the total width of the inline-level boxes on a line is less than the width of the line box containing them, their horizontal distribution within the line box is determined by the 'text-align' property.

In general, the left edge of a line box touches the left edge of its containing block and the right edge touches the right edge of its containing block. However, floating boxes may come between the containing block edge and the line box edge. Thus, although line boxes in the same inline formatting context generally have the same width (that of the containing block), they may vary in width if available horizontal space is reduced due to floats

width of a line box is determined by a containing block and the presence of floats
height of a line box is determined by the rules given in the section on line height calculations

Only _horizontal_ margins, borders, and padding are respected between these boxes

boxes that establish new inline formatting contexts for their contents:
  - block container box that contains no block-level boxes
  
----- 

#### Box model

margin, border, and padding can be broken down into top, right, bottom, and left segments
content box, padding box, border box, margin box
content box depends on several factors like width / height property, if box contains other elements etc.

`background` styles content, padding, and border areas of a box
Margin backgrounds are always transparent, i.e. background of parent element shines through

nested box makes up content of parent box

margin box width / height = content width / height + paddings + borders + margins
vertical margins between boxes collapse.

##### Margin

- `margin` sets width of margin with
- initial value is 0, beware: user agent style sheet may set a value ❗️
The percentage is calculated with respect to the width of the generated box's containing block, even for 'margin-top' and 'margin-bottom'.
vertical margins don't have any effect on inline elements
value can be negative, i.e. moves element ???

- two margins are adjoining iff
  - both belong to in-flow block-level boxes that participate in the same block formatting context
  - no line boxes, no clearance, no padding and no border separate them (Note that certain zero-height line boxes (see 9.4.2) are ignored for this purpose.)
  - both belong to vertically-adjacent box edges, i.e. form one of the following pairs:
    - top margin of a box and top margin of its first in-flow child
    - bottom margin of box and top margin of its next in-flow following sibling
    - bottom margin of a last in-flow child and bottom margin of its parent if the parent has 'auto' computed height
    - top and bottom margins of a box that does not establish a new block formatting context and that has zero computed 'min-height', zero or 'auto' computed 'height', and no in-flow - children

adjoining margins of two or more boxes (which might or might not be siblings) can combine to form a single margin. Margins that combine this way are said to collapse, and the resulting combined margin is called a collapsed margin.

- Adjoining vertical margins collapse, except:
  - Margins of the root element's box do not collapse.
  - If the top and bottom margins of an element with clearance are adjoining, its margins collapse with the adjoining margins of following siblings but that resulting margin does not - collapse with the bottom margin of the parent block.
  - If the top margin of a box with non-zero computed 'min-height' and 'auto' computed 'height' collapses with the bottom margin of its last in-flow child, then the child's bottom margin - does not collapse with the parent's bottom margin.

A collapsed margin is considered adjoining to another margin if any of its component margins is adjoining to that margin.
Note. Adjoining margins can be generated by elements that are not related as siblings or ancestors.

More details: https://www.w3.org/TR/CSS22/box.html#collapsing-margins

- beware: horizontal margins never collapse

##### Padding

The 'padding' shorthand property sets the padding for all four sides while the other padding properties only set their respective side.
- `margin` sets width of margin with
- initial value is 0, beware: user agent style sheet may set a value ❗️
The percentage is calculated with respect to the width of the generated box's containing block, even for 'padding-top' and 'padding-bottom'.

##### Border 

border-width:
- specify the width of the border area
The 'border-width' shorthand property sets the border-width for all four sides while the other border-width properties only set their respective side.

same properties for color and style,
need to set border style because it's `none` by default

`border` shorthand property for setting the width, style, and color of the border


##### Bi-directionality

see https://www.w3.org/TR/CSS22/box.html#bidi-box-model








-----

- an element is a box
- has content, padding, border and margin
four nested boxes
- content resizes automatically to fit content ??

- margin is invisible, separates box from other boxes
- for adjacent boxes horizontal margins add, vertical margins collapse to larger margin of both by default ???
- can be visualised in browser developer tools

Every element has a box around it

![box](box.svg)


beware: documents were designed to allow printing, properties may behave differently when printed, e.g. `margin` ???



initial value of `display` is `inline` but user agent style sheet makes many a `block`






- beware: the content of a box never overflows, just other boxes inside the box can overflow ❗️




Elements can be thought of as boxes sitting on top of other boxes
can control properties of box
    padding, the space around the content. In the example below, it is the space around the paragraph text.
    border, the solid line that just outside the padding.
    margin, the space around the outside of the border.
    width
    background-color, the color behind an element's content and padding.
    color, the color of an element's content (usually text).
    text-shadow sets a drop shadow on the text inside an element.
    display sets the display mode of an element. (keep reading to learn more)


block element, meaning it takes up space on the page. A block element can have margin and other spacing values applied to it. In contrast, images are inline elements. It is not possible to apply margin or spacing values to inline elements. So to apply margins to the image, we must give the image block-level behavior using display: block;.

boxes overflow if don't fit ???, e.g. image larger than body




## Positioning

Normal flow: Inline items are laid out in the same way as the letters in words in text, one after the other across the available space until there is no more room, then starting a new line below. Block items stack vertically, like paragraphs and like the items in a bulleted list. Normal flow also includes relative positioning of block or inline items, and run-in boxes.
Floats: A floated item is taken out of the normal flow and shifted to the left or right as far as possible in the space available. Other elements then flow around the floated item, unless they are prevented from doing so by their clear property.
Absolute positioning: An absolutely positioned item has no place in, and no effect on, the normal flow of other items. It occupies its assigned position in its container independently of other items., can be fixed to point on page or on screen

-> can't use float on absolutely positioned element, i.e. position: absolute, position: fixed
-> can't use positioning properties top, bottom, left, and right on elements in normal flow, i.e. must have position: relative, absolute, fixed

absolutely positioned elements are removed from the flow of elements on the page, they don't affect each other at all, as if it was not there

### Position property

- controls positioning

Static: The default value places the item in the normal flow
Relative: The item is placed in the normal flow, and then shifted or offset from that position. Subsequent flow items are laid out as if the item had not been moved.
Absolute: Specifies absolute positioning. The element is positioned in relation to its nearest non-static ancestor.
Fixed: The item is absolutely positioned in a fixed position on the screen even as the rest of the document is scrolled

### Float property

left: The item floats to the left of the line that it would have appeared in; other items may flow around its right side.
right: The item floats to the right of the line that it would have appeared in; other items may flow around its left side.
clear: Forces an element to appear underneath ('clear') floated elements to the left (clear:left), right (clear:right) or both sides (clear:both)






- usually percentage is calculated relative to width or height of containing block
beware: e.g. percentage for `margin` is relative to _width_ of containing block, even for top and bottom margin ❗️
see definition table