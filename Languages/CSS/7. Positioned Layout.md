# Positioned Layout

[TOC]


<!-- ToDo: finish -->
<!-- note: legacy terminology in/out-of-flow -->

## Introduction

- an irregular layout, can be used with any regular layout
- can use to position element anywhere on page, no matter regular layout of parent
- beware: can position elements off-screen, not reachable anymore for user ‚ùóÔ∏è
- beware: for sticky and fixed positioning assume screen media only, would be different for paged media ‚ùóÔ∏è



## `position` property

- specifies positioning scheme used
- not inherited
- values: `static`, `relative`, `absolute`, `sticky`, `fixed`
- initial value: `static`
- non-positioned elements: elements with `position` being `static`
- positioned elements: elements with `position` being not `static`
- relatively positioned elements: elements with `position` being `relative` or `sticky`
- absolutely positioned elements: elements with `position` being `absolute` or `fixed`

### Static positioning

- no positioning scheme
- box is regularly laid out, i.e. follows FC it's in
- offset and stacking properties don't apply

### Relative positioning

- offset relative to own margin box at `static` location
- space is not taken up by surrounding boxes, as if box were in `static` location
- keeps interacting with surrounding boxes, as if box were in `static` location
- parent grows to contain, as if box were in `static` location
- beware: position can change since dependent on FC, e.g. wrap to next line if ODT is `inline`
- can use to shift position while still keeping interaction

### Sticky positioning

- like relative positioning except offset
- offset relative to nearest scrollport, see Overflow
!?!?beware: the sticky view rectangle is at least the size of the border box of the sticky element
- offset is applied only after box reaches location, i.e. box "sticks" on scroll
- offset is applied only within content box of containing block, i.e. scrolled away after reaches end of containing block
- beware: can't use padding in containing block to extend space since sticks only within content box, needs to use size properties of containing block or last child ‚ùóÔ∏è
- beware: still interacts with surrounding boxes unlike fixed positioning üéâ
- can use to stick on scroll while still keeping interaction, e.g. sticky headers

```html
<!-- parent is containing block of sticky, <html> is scrollport of sticky -->

<div class="wrapper">

  <div class="parent">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
    <p>Curabitur faucibus urna id dolor maximus, vel laoreet felis commodo.</p>
    <p>Aliquam leo sem, efficitur eget molestie ac, pellentesque eget leo.</p>
    <p>Phasellus ut sem mattis eros cursus mattis a non ipsum.</p>
    <div class="sticky"></div>
    <p>Nunc eleifend non elit eget lobortis.</p>
    <p>Duis magna est, tristique nec neque ornare, sodales pharetra odio.</p>
    <p>Duis tristique, enim ut faucibus efficitur, magna dui consequat tortor, nec pharetra magna mauris nec purus.</p>
    <p>Phasellus pulvinar nec nulla ut dictum.</p>
    <p>Ut sollicitudin malesuada nunc, non luctus velit convallis nec.</p>
    <p>Etiam dapibus hendrerit ex eget lobortis.</p>
    <p>Donec dapibus nisi et massa malesuada, quis porttitor purus pulvinar.</p>
    <p>Maecenas sit amet bibendum felis, eu vehicula sapien.</p>
  </div>

  <div class="uncle">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
    <p>Curabitur faucibus urna id dolor maximus, vel laoreet felis commodo.</p>
    <p>Aliquam leo sem, efficitur eget molestie ac, pellentesque eget leo.</p>
    <p>Phasellus ut sem mattis eros cursus mattis a non ipsum.</p>
    <p>Nunc eleifend non elit eget lobortis.</p>
    <p>Duis magna est, tristique nec neque ornare, sodales pharetra odio.</p>
    <p>Duis tristique, enim ut faucibus efficitur, magna dui consequat tortor, nec pharetra magna mauris nec purus.</p>
    <p>Phasellus pulvinar nec nulla ut dictum.</p>
    <p>Ut sollicitudin malesuada nunc, non luctus velit convallis nec.</p>
    <p>Etiam dapibus hendrerit ex eget lobortis.</p>
    <p>Donec dapibus nisi et massa malesuada, quis porttitor purus pulvinar.</p>
    <p>Maecenas sit amet bibendum felis, eu vehicula sapien.</p>
  </div>

  <div class="uncle">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
    <p>Curabitur faucibus urna id dolor maximus, vel laoreet felis commodo.</p>
    <p>Aliquam leo sem, efficitur eget molestie ac, pellentesque eget leo.</p>
    <p>Phasellus ut sem mattis eros cursus mattis a non ipsum.</p>
    <p>Nunc eleifend non elit eget lobortis.</p>
    <p>Duis magna est, tristique nec neque ornare, sodales pharetra odio.</p>
    <p>Duis tristique, enim ut faucibus efficitur, magna dui consequat tortor, nec pharetra magna mauris nec purus.</p>
    <p>Phasellus pulvinar nec nulla ut dictum.</p>
    <p>Ut sollicitudin malesuada nunc, non luctus velit convallis nec.</p>
    <p>Etiam dapibus hendrerit ex eget lobortis.</p>
    <p>Donec dapibus nisi et massa malesuada, quis porttitor purus pulvinar.</p>
    <p>Maecenas sit amet bibendum felis, eu vehicula sapien.</p>
  </div>
</div>
```

```css
.wrapper {
  /* creates some height */
  max-width: 300px;
  margin: 0 auto;
}

.parent {
  background-color: lightblue;
}

.uncle {
  background-color: #EEE;
}

.sticky {
  position: sticky;
  top: 50px;
  height: 32px;
  background-color: tomato;
}
```

### Absolute positioning

- offset relative to containing block
- space is taken up by surrounding boxes, as if box weren't in box tree at all
- doesn't interact with surrounding boxes, as if box weren't in box tree at all
- parent doesn't grow to contain, as if box weren't in box tree at all
- size becomes `max-content` by default, see Size
<!-- ??? DEPENDING ON SELF-ALIGNMENT PROPERTIES -->
???SO WHAT???- blockified
- `float` computes to `none`, i.e. overrides floating behavior in a flow FC ‚ùóÔ∏è
- can use to position anywhere on page

### Fixed positioning

- like absolute positioning except offset
- offset relative to viewport, i.e. box stays fixed on scroll
- beware: breaks page on page zoom since occupies more space, works with page scale only, see Viewport ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
- beware: decreases scroll performance since browser needs to repaint layout instead of just shifting position of pixels ‚ö†Ô∏è
- can use to position anywhere on screen, e.g. persistent navigation menu



## Offset properties

- specify location of margin box
- offset depends on positioning scheme, see above in `position` property
- apply only to positioned element
- beware: no effect on non-positioned elements ‚ùóÔ∏è
- physical properties: `top`, `left`, `right`, `bottom`, shorthand `inset` for all four
- logical properties: `inset-block-start`, `inset-block-end`, `inset-inline-start`, `inset-inline-end`, shorthands `inset-block` for `inset-block-*`, `inset-inline` for `inset-inline-*`, see Writing Mode
- beware: `inset` is physical shorthand for `top`, `bottom`, `left`, `right`, not a logical shorthand for `inset-*` ‚ùóÔ∏è
- value: `auto`, `<length-percentage>`
- initial value: `auto`
- not inherited
- percentage relative to `width`/`height` of containing block
- beware: don't confuse offset and percentage value, percentage always relative to containing block, offset only for absolutely positioned elements ‚ùóÔ∏è
- start side: `top` in vertical axis, `left`/`right` in horizontal axis depending on if direction is `ltr`/`rtl`, see Writing Mode
- end side: opposite side of start side

### `auto`

- for relatively positioned element `auto` values on opposite sides behave as follows
  - if both sides are `auto`, both compute to zero, i.e. box stays in `static` location
  - if one side is `auto`, it computes to negation of other side, i.e. box is shifted
  - if both sides are non-`auto`, end side computes to `auto` since overconstrained, i.e. above case
- beware: size of a relatively positioned element is never changed ‚ùóÔ∏è
- for absolutely positioned element `auto` values on opposite sides behave as follows
  - if both sides are `auto`, both compute such that size doesn't change, aligned according to self-alignment properties, i.e. box is shifted, by default start side aligned to `static` location
  <!-- ToDo: What are self alignment properties? see https://www.w3.org/TR/css-align-3/#abspos-sizing -->
  - if one side is `auto`, it computes such that size doesn't change, i.e. box is shifted
  - if both sides are non-`auto`, if size is `auto` then box is resized, i.e. box is shifted and resized, if size is non-`auto` then end side computes to `auto` since overconstrained, i.e. above case
- beware: size of a absolutely positioned element is only changed when size is `auto` and both offset properties are non-`auto` ‚ùóÔ∏è

```css
p {
  position: absolute; /* fixed */
  width: 300px;
  left: 10px;
  /* ignored since width is explicitly set */
  right: 10px;
}
```



## Containing block

<!-- ToDo: finish -->

depends on position property
used for percentage value type in various box properties, e.g. size, padding, margin, etc.
used for offset properties, but only for absolutely positioned elements
ICB is viewport, but affected by overlay controls, e.g. scrollbars, on-screen keyboard, etc.

positioned box establishes an absolute positioning containing block for its descendants

relatively positioned elements serve as the containing block for positioned descendants !!!

often used without offset just to make it containing block for some absolutely positioned descendant
often makes parent `position: relative` without offsetting at all, just so that children can be absolutely positioned

beware: used for percentage no matter positioning scheme, but for offset properties only for absolutely positioned boxes !!!
beware: `fixed` uses different containing block, percentage is bigger ???!?!?!, e.g. if `width: 100%`


### for relatively positioned element
relative, sticky???

???content box of parent ?? Even for ODT inline??
??if ancestor has ODT inline and split into multiple fragments, then it's the first and last fragments

relative, static, sticky

content box of the nearest ancestor element, except if ODT is inline
ICB if none available

only relevant for percentages

### for absolutely positioned element
absolute, fixed

relevant for percentages and offset

padding edge of nearest ancestor box that establishes an absolute positioning containing block
if ancestor has ODT inline and split into multiple fragments, then it's the first and last fragments
If no ancestor establishes one, the absolute positioning containing block is the initial containing block.
also properties cause a box to establish an absolute positioning containing block: `position`, `transform`, `will-change`, `contain`, etc.

???FORGOT TO EDIT TO FIXED???
padding edge of nearest ancestor box that establishes an absolute positioning containing block
if ancestor has ODT inline and split into multiple fragments, then it's the first and last fragments
If no ancestor establishes one, the fixed positioning containing block is the viewport (in continuous media)
also properties cause a box to establish an fixed positioning containing block: `transform`, `will-change`, `contain`, etc.

???positioned and sized relative to its absolute positioning containing block

--

padding box of the nearest positioned ancestor element (for absolute)
ICB if none available (and for fixed)
needs to add size of padding to size of CB in calculation
?? beware: if CB has `box-sizing: border-box`, instead needs to subtract size of border

beware: can also be padding box of nearest ancestor that has `transform`, `perspective`, `will-change`, `filter`, `contain` set to specific values, see XXX?

--

often uses position: relative without any offset just to make an ancestor the CB for an absolutely positioned descendant

ancestor element with XXX?
?? the ancestor to which the element is relatively positioned.

?? dependent on the position property of the ancestors
initial containing block if no ancestor is containing block

ICB: viewport ??

??for in-flow-elements is nearest block-level ancestor
??for out-of-flow elements is nearest positioned ancestor
??viewport if there is no containing block

??only important for Positioned Layout

- rectangle with respect to which a box is sized and laid out / positioned
- derived from dimensions of a box, except for initial containing block ???

??? - principal box that establishes the current formatting context

- beware: a box is not confined by its containing block, can overflow ‚ùóÔ∏è
- initial containing block: containing block of the root element
has size of viewport except affected by scrollbars

<!-- ToDo: move to layout
e.g. inline box‚Äôs containing block is the content box of its closest block container ancestor; ?? OLD FLOW TERMINOLOGY

if that block container is an in-flow block, then its containing block is formed by its parent block container;

if that grandparent block container is absolutely positioned, then its containing block is the padding edges of its closest positioned ancestor (not necessarily its parent)

and so on up to the initial containing block.


e.g. inline box‚Äôs containing block is the content box of its closest block container ancestor  ?? OLD FLOW TERMINOLOGY
absolutely positioned boxes containing block is the padding edges of its closest positioned ancestor
 -->

- beware: don't confuse content of box with boxes that have it as containing block, descendant boxes in box tree seem like content of box, but content can't overflow its box while a box can overflow its containing block

- beware: "a box's containing block" means the containing block of the box, not the one it establishes ‚ùóÔ∏è


<!-- from old layout -->
- box respective to which position and size of a descendant box is calculated
- beware: descendant box is positioned with respect to its containing block, but it is not confined by this containing block, it may overflow ‚ùóÔ∏è
- usually the parent element's box, e.g. ul of li, but not necessarily ????????

##

absolutely positioned elements establish new block formatting contexts for their contents
Absolute positioning or floating an element blockifies the box‚Äôs display type.
making a box out-of-flow causes it to blockify as well as to establish an independent formatting context

blockifies element, i.e. makes ODT block, irrelevant since out-of-flow ??, but allows size properties, but default is `max-content`

ONLY RELEVANT TO BE CONTAINING BLOCK OF DESCENDANTS??




## Containing positioned elements

parent doesn't grow to contain absolutely positioned childs, as if they don't exist
(see Float)
can fix HOW???
except for relative (and stickily) positioned child at the original position
needs to make sure parent is larger than absolutely positioned child



## Stacking

positioned elements create new stacking context ??when the value of z-index is not auto


?? positioned elements are above in-flow elements 
?? positioned elements later in the source order win over positioned elements earlier in the source order



beware: relative positioned box is above float in stacking context, i.e. background obscures float, hover on float doesn't work, etc.
see Google "relative position float stacking", https://stackoverflow.com/questions/43214089/unexplained-stacking-of-css-float-and-positionrelative, https://stackoverflow.com/questions/40473051/why-does-a-relative-positioned-element-appear-above-a-floated-element
??can fix by giving float also relative position and a higher z-index


```html
<h1>Stacking order for relative position and float</h1>
<p>Note: Make sure to view on screen width with at least 600px to view the effect.</p>
<div class="float">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
<div>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
<div class="relative">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
```

```css
div {
  background: lightgrey;
  margin-bottom: 5px;
}

.float {
  float: right;
  background: tomato;
  width: 200px;
}

.relative {
  position: relative
}
```



## Resources

- [W3C - CSS Positioned Layout Module Level 3](https://www.w3.org/TR/css-position-3/)