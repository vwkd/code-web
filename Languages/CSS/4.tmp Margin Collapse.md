# Margin Collapse

[TOC]


<!-- note: legacy terminology in/out-of-flow -->

## Introduction

- one of the worst design choices, language should never impose a guess what's best for most users automatically, increases complexity everywhere, can't even disable ⚠️⚠️⚠️
- CSS versioning should be introduced to remove margin collapse and other bugs, see zBlog/A versioned Web.md




---

? only vertical margins collapse
? in all FCs, or only in block layout ?
? margins DO collapse accross flow formatting context boundaries but not accross flow-root boundaries

beware: setting borders disables margin collapse !!!?!!!

not for out-of-flow boxes

BEWARE: vertical margins collapse between visually adjacent boxes, not necessary siblings in box tree, e.g. child in a deep flow FC chain with margin of sibling of highest ancestor establishing box??
very prone to error !!!
disables possibility for `box-sizing: margin-box`

--

Vertical margins between two floated elements will not collapse
no margin collapse for floats, absolutely positioned boxes, inline-block boxes (old term!)

--

??The margins of absolutely positioned boxes do not collapse with other margins ??WHAT OTHER MARGINS

---

## Containing margin

- historic bug of flow FC, fixed with flow-root FC
- a box doesn't contain margin at top and bottom of children, i.e. top margin of first child and bottom margin of last child

```html
<div class="wrapper">
  <div class="child"></div>
  <div class="child"></div>
</div>
```

```css
.child {
  width: 100%;
  height: 50px;
  background-color: rgb(255,0,0,0.2);
  border: 1px dashed red;
  margin: 10px 0;
}

.wrapper {
  background-color: lightgrey;
  /* display: flow-root; */
}
```

- beware: don't use legacy hacks anymore, instead use flow-root FC in wrapper box, see [SO](https://stackoverflow.com/a/32301823/2607891) ❗️
- legacy hacks were 2,3 and 4 like for containing floats, see Float Layout#Containing floats

--

<!-- beware from old layout, incorporate then delete -->

##### Margin

- two margins are adjoining iff
  - both belong to in-flow block-level boxes that participate in the same block formatting context
  - no line boxes, no clearance, no padding and no border separate them (Note that certain zero-height line boxes (see 9.4.2) are ignored for this purpose.)
  - both belong to vertically-adjacent box edges, i.e. form one of the following pairs:
    - top margin of a box and top margin of its first in-flow child
    - bottom margin of box and top margin of its next in-flow following sibling
    - bottom margin of a last in-flow child and bottom margin of its parent if the parent has 'auto' computed height
    - top and bottom margins of a box that does not establish a new block formatting context and that has zero computed 'min-height', zero or 'auto' computed 'height', and no in-flow - children

adjoining margins of two or more boxes (which might or might not be siblings) can combine to form a single margin. Margins that combine this way are said to collapse, and the resulting combined margin is called a collapsed margin.

vertical margins between boxes collapse.
- Adjoining vertical margins collapse, except:
  - Margins of the root element's box do not collapse.
  - If the top and bottom margins of an element with clearance are adjoining, its margins collapse with the adjoining margins of following siblings but that resulting margin does not - collapse with the bottom margin of the parent block.
  - If the top margin of a box with non-zero computed 'min-height' and 'auto' computed 'height' collapses with the bottom margin of its last in-flow child, then the child's bottom margin - does not collapse with the parent's bottom margin.

A collapsed margin is considered adjoining to another margin if any of its component margins is adjoining to that margin.
Note. Adjoining margins can be generated by elements that are not related as siblings or ancestors.

More details: https://www.w3.org/TR/CSS22/box.html#collapsing-margins

- beware: horizontal margins never collapse

Vertical margins between adjacent block-level boxes in a block formatting context collapse.


## Resources

<!-- ToDo: see CSS2 8.3.1-->
